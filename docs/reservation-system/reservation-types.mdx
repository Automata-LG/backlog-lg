---
title: '예약 시스템 타입 정의'
description: '예약 시스템에서 사용되는 TypeScript 타입, 인터페이스, 상수 정의'
icon: 'brackets-curly'
---

## 기본 타입 정의

### 주소 및 위치 관련

```typescript
/**
 * 주소 인터페이스
 */
export interface IAddress {
  zipCode: string;          // 우편번호
  mainAddress: string;      // 기본 주소
  detailAddress?: string;   // 상세 주소 (선택)
}
```

### 시간 및 일정 관련

```typescript
/**
 * 요일 상수
 */
export const Weekday = {
  MON: 'MON',
  TUE: 'TUE',
  WED: 'WED',
  THU: 'THU',
  FRI: 'FRI',
  SAT: 'SAT',
  SUN: 'SUN',
} as const;

/**
 * 요일 타입 정의
 */
export type TWeekday = (typeof Weekday)[keyof typeof Weekday];

/**
 * 운영 시간 인터페이스
 */
export interface IOperatingHours {
  days: TWeekday[];  // 운영 요일
  hours: {
    openTime: string;   // HH:mm 형식
    closeTime: string;  // HH:mm 형식
  }[];
}

/**
 * 휴무일 인터페이스
 */
export interface IHolidays {
  regular: {
    weekly: TWeekday[];  // 매주 반복되는 휴무일
    monthly: {
      weeks: number[];   // 몇째 주 (1-5)
      days: TWeekday[];  // 요일
    }[];
    yearly: {
      month: number;     // 월 (1-12)
      day: number;       // 일 (1-31)
    }[];
  };
  specific: string[];    // YYYY-MM-DD 형식의 특정 날짜
}
```

### 연락처 정보 관련

```typescript
/**
 * 연락처 유형 상수
 */
export const ContactType = {
  CUSTOMER_SUPPORT: 'CUSTOMER_SUPPORT',  // 고객 지원
  RESERVATION: 'RESERVATION',            // 예약 문의
} as const;

/**
 * 채널 유형 상수
 */
export const ChannelType = {
  KAKAO: 'KAKAO',
  LINE: 'LINE',
  FACEBOOK: 'FACEBOOK',
  INSTAGRAM: 'INSTAGRAM',
  TIKTOK: 'TIKTOK',
} as const;

/**
 * 연락처 타입 정의
 */
export type TContactType = (typeof ContactType)[keyof typeof ContactType];

/**
 * 채널 타입 정의
 */
export type TChannelType = (typeof ChannelType)[keyof typeof ChannelType];

/**
 * 연락처 정보 인터페이스
 */
export interface IContactInfo {
  phoneNumbers?: {
    type: TContactType;      // 연락처 유형
    number: string;          // 전화번호
    description?: string;    // 설명 (예: 운영 시간)
  }[];
  channels?: {
    type: TChannelType;      // 채널 유형
    url: string;            // 채널 URL
    name?: string;          // 채널 이름
  }[];
}
```

### 멤버십 및 제한 관련

```typescript
/**
 * 멤버십 등급 상수
 */
export const MembershipGrade = {
  AS00: 'AS00',  // 다이아몬드 블랙
  AS01: 'AS01',  // 다이아몬드
  AS02: 'AS02',  // 플래티넘
  AS03: 'AS03',  // 골드
  AS04: 'AS04',  // 실버
  AS05: 'AS05',  // 실버
} as const;

/**
 * 멤버십 등급 타입 정의
 */
export type TMembershipGrade = (typeof MembershipGrade)[keyof typeof MembershipGrade];

/**
 * 제한 설정 인터페이스
 */
export interface IRestrictionConfig {
  minMembershipGrade?: TMembershipGrade;  // 최소 멤버십 등급
  // 추가 제한 설정 확장 가능
}
```

## 예약 설정 관련

### 예약 확정 유형

```typescript
/**
 * 예약 확정 유형 상수
 */
export const ConfirmType = {
  IMMEDIATE: 'IMMEDIATE',           // 즉시 확정
  ADMIN_APPROVAL: 'ADMIN_APPROVAL', // 관리자 승인
  LOTTERY: 'LOTTERY',               // 추첨
} as const;

/**
 * 확정 타입 정의
 */
export type TConfirmType = (typeof ConfirmType)[keyof typeof ConfirmType];

/**
 * 예약 확정 설정 인터페이스
 */
export interface IConfirmConfig {
  confirmType: TConfirmType;
  lotteryDate?: string;     // YYYY-MM-DD (추첨 방식일 때)
  lotteryCapacity?: number;  // 당첨 가능 인원 (추첨 방식일 때)
}
```

### 예약 오픈 타입

```typescript
/**
 * 예약 오픈 타입 상수
 */
export const OpenType = {
  BATCH: 'BATCH',         // 일괄 오픈
  SEQUENTIAL: 'SEQUENTIAL', // 순차 오픈
  GRADED: 'GRADED',       // 등급별 차등 오픈
} as const;

/**
 * 예약 오픈 타입 정의
 */
export type TReservationOpenType = (typeof OpenType)[keyof typeof OpenType];

/**
 * 멤버십 등급 타입
 */
export type TMembershipGrade = 'AS00' | 'AS01' | 'AS02' | 'AS03' | 'AS04' | 'AS05';

/**
 * 기본 예약 오픈 설정 인터페이스
 */
export interface IBaseOpenConfig {
  openType: TReservationOpenType;
  modificationByHours?: number;  // 수정 마감 시간 (시작 N시간 전)
}

/**
 * 일괄 오픈 설정 인터페이스
 */
export interface IBatchOpenConfig extends IBaseOpenConfig {
  openType: typeof OpenType.BATCH;
  openStartAt: string;         // ISO 8601 DateTime
  openEndAt: string;          // ISO 8601 DateTime
  reservationByHours?: number;  // 예약 마감 시간 (시작 N시간 전)
}

/**
 * 순차 오픈 설정 인터페이스
 */
export interface ISequentialOpenConfig extends IBaseOpenConfig {
  openType: typeof OpenType.SEQUENTIAL;
  openStartByDays: number;  // 시작 N일 전 12:00 오픈
  openEndByDays: number;    // 시작 N일 전 23:59 마감
}

/**
 * 등급별 차등 오픈 설정 인터페이스
 */
export interface IGradedOpenConfig extends IBaseOpenConfig {
  openType: typeof OpenType.GRADED;
  openStartAtByGrade?: {
    [key in TMembershipGrade]: string;  // ISO 8601 DateTime
  };  // 미제공 시 자동 계산 (SKS_RESERVATION_POLICY 기반)
  modificationByDays?: number;  // D-N일 수정/취소 마감
  reservationByDays?: number;   // D-N일 예약 마감
}

/**
 * 오픈 설정 유니온 타입
 */
export type TOpenConfig = IBatchOpenConfig | ISequentialOpenConfig | IGradedOpenConfig;
```

## 예약 상태 관리

### 상태 변경 주체

```typescript
/**
 * 예약 상태 변경 주체
 */
export const ReservationStatusChanger = {
  USER: 'USER',     // 사용자
  ADMIN: 'ADMIN',   // 관리자
  SYSTEM: 'SYSTEM', // 시스템 (자동화)
} as const;

export type TReservationStatusChanger = 
  (typeof ReservationStatusChanger)[keyof typeof ReservationStatusChanger];
```

### 시스템 작업 유형

```typescript
/**
 * 예약 시스템 작업 유형
 */
export const ReservationSystemAction = {
  LOTTERY_WIN: 'LOTTERY_WIN',   // 추첨 당첨
  LOTTERY_FAIL: 'LOTTERY_FAIL', // 추첨 낙첨
  EXPIRE: 'EXPIRE',             // 자동 만료
  NOSHOW: 'NOSHOW',             // 자동 노쇼
  QR_VERIFY: 'QR_VERIFY',       // QR 확인
} as const;

export type TReservationSystemAction = 
  (typeof ReservationSystemAction)[keyof typeof ReservationSystemAction];
```

### 상태 변경 이유 코드

```typescript
/**
 * 예약 상태 변경 이유 코드
 */
export const ReservationStatusReasonCode = {
  // 초기 예약 생성
  USER_CREATE_PENDING: 'USER_CREATE_PENDING',
  ADMIN_CREATE_PENDING: 'ADMIN_CREATE_PENDING',
  USER_CREATE_CONFIRMED: 'USER_CREATE_CONFIRMED',
  ADMIN_CREATE_CONFIRMED: 'ADMIN_CREATE_CONFIRMED',

  // PENDING → CONFIRMED
  ADMIN_CONFIRM: 'ADMIN_CONFIRM',
  SYSTEM_LOTTERY_WIN: 'SYSTEM_LOTTERY_WIN',

  // PENDING → CANCELLED
  USER_CANCEL: 'USER_CANCEL',
  ADMIN_CANCEL: 'ADMIN_CANCEL',
  SYSTEM_LOTTERY_FAIL: 'SYSTEM_LOTTERY_FAIL',
  SYSTEM_EXPIRE: 'SYSTEM_EXPIRE',

  // 예약 수정 (상태 유지)
  USER_MODIFY_PENDING: 'USER_MODIFY_PENDING',
  ADMIN_MODIFY_PENDING: 'ADMIN_MODIFY_PENDING',
  USER_MODIFY_CONFIRMED: 'USER_MODIFY_CONFIRMED',
  ADMIN_MODIFY_CONFIRMED: 'ADMIN_MODIFY_CONFIRMED',

  // 상태 변경을 수반하는 수정
  USER_MODIFY_TO_PENDING: 'USER_MODIFY_TO_PENDING',
  ADMIN_MODIFY_TO_PENDING: 'ADMIN_MODIFY_TO_PENDING',

  // CONFIRMED → USED/NOSHOW
  ADMIN_MARK_USED: 'ADMIN_MARK_USED',
  SYSTEM_QR_VERIFY: 'SYSTEM_QR_VERIFY',
  SYSTEM_NOSHOW: 'SYSTEM_NOSHOW',

  // 이용 완료/노쇼 후 취소
  ADMIN_USED_CANCEL: 'ADMIN_USED_CANCEL',
  ADMIN_NOSHOW_CANCEL: 'ADMIN_NOSHOW_CANCEL',
} as const;

export type TReservationStatusReasonCode = 
  (typeof ReservationStatusReasonCode)[keyof typeof ReservationStatusReasonCode];
```

### 예약 변경 내역

```typescript
/**
 * 예약 상세 변경 내역 인터페이스
 */
export interface IReservationDetailedChanges {
  /** 타임슬롯 변경 */
  timeSlot?: {
    old: {
      id: string;
      startAt: Date;
    };
    new: {
      id: string;
      startAt: Date;
    };
  };

  /** 그룹 인원 변경 */
  groupSize?: {
    old: number;
    new: number;
  };

  /** 전화번호 변경 */
  phoneNumber?: {
    old: string;
    new: string;
  };

  /** 예약 상태 변경 */
  status?: {
    old: ReservationStatus;
    new: ReservationStatus;
  };

  /** 유닛 ID 변경 */
  unitId?: {
    old: string | null;
    new: string | null;
  };

  /** 요청사항 변경 */
  requestNote?: {
    old: string | null;
    new: string | null;
  };

  /** 추가정보 변경 */
  additionalInfo?: {
    old: any;
    new: any;
  };
}
```

### 예약 추가 정보

```typescript
/**
 * 예약 추가 정보 인터페이스
 * 예약 생성/수정 시 추가적인 정보를 담는 필드
 */
export interface IReservationAdditionalInfo {
  /** 방문 예정 시간 (HH:MM 형식) */
  visitTime?: string;
  /** 차량 번호 (예: 123-가-1234, 서울 12-가-1234) */
  vehicleNumber?: string;
  /** 쇼룸 투어 필요 여부 */
  needsShowroomTour?: boolean;
  /** 제품 상담 필요 여부 */
  needsProductConsultation?: boolean;
}
```

## 가격 항목 타입

### ReservationPriceKind (가격 항목 종류)

```typescript
export enum ReservationPriceKind {
  TICKET = 'TICKET',   // 티켓
  MENU = 'MENU',       // 메뉴
  SERVICE = 'SERVICE'  // 서비스
}
```

### ReservationPriceType (가격 유형)

```typescript
export enum ReservationPriceType {
  FIXED = 'FIXED',       // 고정 가격
  PER_UNIT = 'PER_UNIT'  // 단위당 가격
}
```

### 가격 항목 인터페이스

```typescript
interface ReservationPriceItem {
  id: string;
  kind: ReservationPriceKind;
  name: string;
  description?: string;
  basePrice: number;
  priceType: ReservationPriceType;
  minQuantity: number;
  maxQuantity: number;  // 0이면 무제한
  images: string[];
  contentId: string;
  index: string;       // Fractional 인덱싱
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

## 기타 유틸리티 타입

### 정렬 옵션

```typescript
/**
 * 기본 정렬 방식
 */
export const OrderBy = {
  createdAt_asc: 'createdAt_asc',
  createdAt_desc: 'createdAt_desc',
  updatedAt_asc: 'updatedAt_asc',
  updatedAt_desc: 'updatedAt_desc',
  index_asc: 'index_asc',
  index_desc: 'index_desc'
} as const;

/**
 * 타임슬롯 정렬 방식
 */
export const TimeSlotOrderBy = {
  ...OrderBy,
  startAt_asc: 'startAt_asc',
  startAt_desc: 'startAt_desc',
} as const;
```

### 진행 상태 필터

```typescript
/**
 * 진행 상태 필터
 */
export const ProgressStatusFilter = {
  UPCOMING: 'UPCOMING',     // 예정됨
  IN_PROGRESS: 'IN_PROGRESS', // 진행 중
  ENDED: 'ENDED',           // 종료됨
} as const;

export type TProgressStatusFilter = keyof typeof ProgressStatusFilter;
```

## 체크인 관련 스키마

### appReservationCheckInInputSchema

```typescript
export const appReservationCheckInInputSchema = z.object({
  id: z.string().uuid({ message: '유효한 예약 ID가 필요합니다' }),
  note: z.string().max(500, { message: '노트는 최대 500자까지 가능합니다' }).optional()
});
```

## 예약 통계 스키마

### overallReservationStatsSchema

```typescript
export const overallReservationStatsSchema = z.object({
  // 수용/잔여 인원
  totalCapacity: z.number(),        // 전체 수용 인원
  availableCapacity: z.number(),    // 전체 잔여 인원

  // 예약 현황
  pendingCount: z.number(),         // 전체 대기 예약 수
  confirmedCount: z.number(),       // 전체 확정 예약 수
  cancelledCount: z.number(),       // 전체 취소 예약 수
  usedCount: z.number(),            // 전체 이용완료 예약 수
  noshowCount: z.number(),          // 전체 노쇼 예약 수

  // 인원 통계
  totalPendingSize: z.number(),     // 전체 대기 인원
  totalConfirmedSize: z.number(),   // 전체 확정 인원
  totalCancelledSize: z.number(),   // 전체 취소 인원
  totalUsedSize: z.number(),        // 전체 이용완료 인원
  totalNoshowSize: z.number(),      // 전체 노쇼 인원

  // 복합 계산 수치
  actualReservedSize: z.number(),   // 전체 실제점유 인원
  actualConfirmedSize: z.number(),  // 전체 실제확정 인원
  actualCancelledSize: z.number(),  // 전체 실제취소 인원

  // 비율 통계
  reservationRate: z.number(),      // 전체 예약률
  confirmationRate: z.number(),     // 전체 확정률
  utilizationRate: z.number(),      // 전체 이용률
  cancellationRate: z.number(),     // 전체 취소율
  noshowRate: z.number(),           // 전체 노쇼율

  // 타임슬롯별 통계
  timeSlotStats: z.array(reservationTimeSlotStatsSchema)
});
```

## 샘플 데이터

### 운영 시간 샘플

```typescript
const operatingHoursSample: IOperatingHours[] = [
  {
    days: ['MON', 'TUE', 'WED', 'THU', 'FRI'],
    hours: [{ openTime: '10:00', closeTime: '19:00' }]
  },
  {
    days: ['SAT'],
    hours: [
      { openTime: '10:00', closeTime: '14:00' },
      { openTime: '16:00', closeTime: '20:00' }
    ]
  }
];
```

### 휴무일 샘플

```typescript
const holidaysSample: IHolidays = {
  regular: {
    weekly: ['SUN'],  // 매주 일요일 휴무
    monthly: [
      {
        weeks: [1, 3],  // 첫째, 셋째 주
        days: ['MON']   // 월요일
      }
    ],
    yearly: [
      { month: 1, day: 1 },   // 신정
      { month: 12, day: 25 }  // 크리스마스
    ]
  },
  specific: [
    '2025-05-05',  // 어린이날
    '2025-08-15',  // 광복절
    '2025-09-28'   // 추석
  ]
};
```

### 연락처 정보 샘플

```typescript
const contactInfoSample: IContactInfo = {
  phoneNumbers: [
    {
      type: 'CUSTOMER_SUPPORT',
      number: '02-1234-5678',
      description: '평일 9시-18시 운영'
    },
    {
      type: 'RESERVATION',
      number: '02-2345-6789',
      description: '예약 전용'
    }
  ],
  channels: [
    {
      type: 'KAKAO',
      url: 'https://pf.kakao.com/_example',
      name: '공식 카카오톡 채널'
    },
    {
      type: 'INSTAGRAM',
      url: 'https://instagram.com/lgartcenter',
      name: 'LG아트센터'
    }
  ]
};
```

### 예약 확정 설정 샘플

```typescript
// 즉시 확정
const immediateConfirm: IConfirmConfig = {
  confirmType: 'IMMEDIATE'
};

// 관리자 승인
const adminApprovalConfirm: IConfirmConfig = {
  confirmType: 'ADMIN_APPROVAL'
};

// 추첨 방식
const lotteryConfirm: IConfirmConfig = {
  confirmType: 'LOTTERY',
  lotteryDate: '2025-05-15',
  lotteryCapacity: 30
};
```

### 예약 오픈 설정 샘플

```typescript
// 일괄 오픈
const batchOpenConfig: IBatchOpenConfig = {
  openType: 'BATCH',
  openStartAt: '2025-06-01T10:00:00Z',
  openEndAt: '2025-06-10T18:00:00Z',
  reservationByHours: 24,  // 시작 24시간 전 예약 마감
  modificationByHours: 48   // 시작 48시간 전 수정 마감
};

// 순차 오픈
const sequentialOpenConfig: ISequentialOpenConfig = {
  openType: 'SEQUENTIAL',
  openStartByDays: 3,      // 3일 전 12:00 오픈
  openEndByDays: 1,        // 1일 전 23:59 마감
  modificationByHours: 36  // 36시간 전 수정 마감
};
```

### 제한 설정 샘플

```typescript
// 골드 등급 이상만 예약 가능
const restrictionConfig: IRestrictionConfig = {
  minMembershipGrade: 'AS03'
};
```

### 예약 추가 정보 샘플

```typescript
// 예약 추가 정보
const additionalInfoSample: IReservationAdditionalInfo = {
  visitTime: '19:30',
  vehicleNumber: '123-가-1234',
  needsShowroomTour: true,
  needsProductConsultation: false
};

// 지역 번호판 예시
const additionalInfoWithRegion: IReservationAdditionalInfo = {
  visitTime: '14:00',
  vehicleNumber: '서울 12-가-5678',
  needsShowroomTour: false,
  needsProductConsultation: true
};
```

## 타입 가드 함수

```typescript
/**
 * 일괄 오픈 설정인지 확인
 */
export function isBatchOpenConfig(config: TOpenConfig): config is IBatchOpenConfig {
  return config.openType === OpenType.BATCH;
}

/**
 * 순차 오픈 설정인지 확인
 */
export function isSequentialOpenConfig(config: TOpenConfig): config is ISequentialOpenConfig {
  return config.openType === OpenType.SEQUENTIAL;
}

/**
 * 추첨 방식인지 확인
 */
export function isLotteryConfirm(config: IConfirmConfig): boolean {
  return config.confirmType === ConfirmType.LOTTERY;
}
```

## 유틸리티 함수

```typescript
/**
 * 멤버십 등급 비교
 * @returns grade1이 grade2보다 높으면 양수, 같으면 0, 낮으면 음수
 */
export function compareMembershipGrade(
  grade1: TMembershipGrade,
  grade2: TMembershipGrade
): number {
  const grades = Object.values(MembershipGrade);
  return grades.indexOf(grade2) - grades.indexOf(grade1);
}

/**
 * 특정 날짜가 휴무일인지 확인
 */
export function isHoliday(date: Date, holidays: IHolidays): boolean {
  const dateStr = date.toISOString().split('T')[0];
  
  // 특정 휴무일 확인
  if (holidays.specific.includes(dateStr)) {
    return true;
  }
  
  // 주간 휴무일 확인
  const dayOfWeek = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'][date.getDay()];
  if (holidays.regular.weekly.includes(dayOfWeek as TWeekday)) {
    return true;
  }
  
  // 월간 정기 휴무일 확인
  const weekOfMonth = Math.ceil(date.getDate() / 7);
  for (const monthly of holidays.regular.monthly) {
    if (monthly.weeks.includes(weekOfMonth) && 
        monthly.days.includes(dayOfWeek as TWeekday)) {
      return true;
    }
  }
  
  // 연간 정기 휴무일 확인
  for (const yearly of holidays.regular.yearly) {
    if (yearly.month === date.getMonth() + 1 && 
        yearly.day === date.getDate()) {
      return true;
    }
  }
  
  return false;
}
```